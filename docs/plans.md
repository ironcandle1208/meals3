# 開発計画書 (Implementation Plan)

## 1. 技術スタック選定と理由

### フレームワーク: React Native (Expo)
**選定理由:**
- **クロスプラットフォーム対応:** 要件にある「iOS・Androidの双方でUXが変わらないように設計」を満たすため、単一のコードベースで両OSに対応できるReact Nativeが最適です。
- **開発効率とコスト:** Expoを使用することで、ネイティブビルドの複雑さを回避し、開発スピードを向上させられます。また、オープンソースでありライセンス費用がかからないため、「金銭的コストは最小限」という要件にも合致します。

### バックエンド/データベース: Supabase
**選定理由:**
- **コストパフォーマンス:** 寛大な無料枠があり、初期コストを抑えられます。
- **機能の網羅性:** 認証（Auth）、データベース（PostgreSQL）、リアルタイム更新が統合されており、個別にサービスを組み合わせる必要がありません。
- **リレーショナルデータ:** ユーザー、グループ、献立、材料といったデータ構造はリレーショナルデータベース（RDB）との相性が良く、整合性を保ちやすいです。

### アーキテクチャ構成
- **フロントエンド:** React Native + Expo Router (ファイルベースルーティング)
- **状態管理:** TanStack Query (React Query) - サーバーデータのキャッシュと同期に利用。
- **UIライブラリ:** React Native Paper - マテリアルデザインベースで、統一感のあるUIを容易に構築可能。

## 2. システムアーキテクチャ詳細

### データベース設計 (Supabase PostgreSQL)

| テーブル名 | 説明 | 主なカラム |
| --- | --- | --- |
| `profiles` | ユーザー情報 | `id` (uuid), `email`, `display_name`, `avatar_url` |
| `groups` | グループ情報 | `id` (uuid), `name`, `created_by` |
| `group_members` | グループ所属 | `group_id`, `user_id`, `role` |
| `recipes` | 献立 | `id`, `group_id`, `name`, `instructions`, `image_url` |
| `ingredients` | 材料 | `id`, `recipe_id`, `name`, `quantity`, `unit` |
| `tags` | タグ | `id`, `group_id`, `name` |
| `recipe_tags` | 献立とタグの紐付け | `recipe_id`, `tag_id` |
| `schedules` | スケジュール | `id`, `group_id`, `date`, `meal_type` (朝/昼/夕), `recipe_id` |
| `shopping_items` | 買い物リスト | `id`, `group_id`, `name`, `is_purchased`, `source_type` (auto/manual) |

### データフロー
1. **認証:** ユーザーはSupabase Authでログイン。
2. **グループ同期:** ユーザーは `group_id` を介してデータを参照。RLS (Row Level Security) ポリシーにより、同じグループのメンバーのみがデータにアクセス可能。
3. **買い物リスト生成:** スケジュール登録時にトリガーまたはクライアントサイドのロジックで必要な材料をリストアップ。

## 3. 実装フェーズ

### Phase 1: プロジェクトセットアップ & 認証 (P1)
- Expoプロジェクトの初期化
- Supabaseプロジェクトの作成と接続
- サインアップ・ログイン・ログアウト機能の実装
- プロフィール作成

### Phase 2: グループ機能 & 献立管理 (P1)
- グループ作成・招待機能
- 献立のCRUD（作成・読み取り・更新・削除）
- 材料の登録
- タグ付け機能

### Phase 3: スケジュール & 買い物リスト (P1)
- カレンダー表示（日・週・月）
- 献立のスケジュール登録
- スケジュールに基づく買い物リストの自動生成
- チェックリスト機能

### Phase 4: AI機能 & ブラッシュアップ (P2/P3)
- UI/UXの改善
- AI献立提案機能（OpenAI API等との連携を検討）

## 4. 検証計画
- **単体テスト:** Jestを用いたロジックのテスト。
- **E2Eテスト:** 実機またはシミュレーターでの動作確認。特にグループ間でのリアルタイム同期を確認する。
